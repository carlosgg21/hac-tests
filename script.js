// Translations
const translations = {
  en: {
    nav_about: "About",
    nav_services: "Services",
    nav_portfolio: "Portfolio",
    nav_contact: "Contact",
    nav_quote: "Get a Quote",
    hero_title: "Transform Your Space<br>with Expert Craftsmanship",
    hero_subtitle: "Professional construction and renovation services for residential and commercial projects",
    hero_cta_primary: "Get Free Quote",
    hero_cta_secondary: "View Our Work",
    about_title: "About H.A.C. Renovation",
    about_text1:
      "With years of experience in the construction industry, H.A.C. Renovation Inc. has built a reputation for excellence, reliability, and outstanding craftsmanship. We specialize in transforming residential and commercial spaces into beautiful, functional environments.",
    about_text2:
      "Our team of skilled professionals is committed to delivering high-quality results on time and within budget. From initial consultation to project completion, we work closely with our clients to ensure their vision becomes reality.",
    about_stat1: "Years Experience",
    about_stat2: "Projects Completed",
    about_stat3: "Client Satisfaction",
    services_title: "Our Services",
    services_subtitle: "Comprehensive construction and renovation solutions for your project needs",
    service1_title: "Interior Demolition",
    service1_desc:
      "Safe and efficient demolition services to prepare your space for renovation. We handle all debris removal and site preparation.",
    service2_title: "Framing & Structure",
    service2_desc:
      "Expert framing services for walls, ceilings, and structural modifications. Quality craftsmanship ensuring stability and code compliance.",
    service3_title: "Plaster & Painting",
    service3_desc:
      "Professional drywall installation, plastering, and painting services. Smooth finishes and vibrant colors to bring your vision to life.",
    service4_title: "Patio & Fencing",
    service4_desc:
      "Custom outdoor living spaces with beautiful patios and secure fencing. Enhance your property's curb appeal and functionality.",
    service5_title: "Concrete Work",
    service5_desc:
      "Durable concrete solutions for foundations, driveways, walkways, and more. Precision work that stands the test of time.",
    service6_title: "Floors & Tiling",
    service6_desc:
      "Expert installation of hardwood, laminate, tile, and more. Beautiful floors that combine style with durability.",
    portfolio_title: "Our Work",
    portfolio_subtitle: "See the transformations we've accomplished for our satisfied clients",
    portfolio_before: "Before",
    portfolio_after: "After",
    project1_title: "Kitchen Renovation",
    project1_desc: "Complete kitchen remodel with new cabinets, countertops, and flooring",
    project2_title: "Bathroom Remodel",
    project2_desc: "Modern bathroom transformation with new fixtures and tiling",
    project3_title: "Basement Finishing",
    project3_desc: "Complete basement conversion into livable entertainment space",
    project4_title: "Patio Construction",
    project4_desc: "Custom outdoor patio with premium materials and landscaping",
    contact_title: "Get in Touch",
    contact_subtitle: "Ready to start your renovation project? Contact us today for a free consultation and quote.",
    contact_phone_label: "Phone",
    contact_email_label: "Email",
    contact_address_label: "Address",
    form_name: "Name",
    form_email: "Email",
    form_phone: "Phone",
    form_message: "Message",
    form_submit: "Send Message",
    form_is_owner: "I am the property owner",
    form_get_quote: "Get Free Quote",
    wizard_title: "Get Your Free Quote",
    wizard_step1: "Basic Info",
    wizard_step2: "Project Details",
    wizard_step3: "Budget & Time",
    wizard_step4: "Review",
    wizard_step1_title: "Basic Information",
    wizard_step2_title: "Project Details",
    wizard_step3_title: "Budget & Timeline",
    wizard_step4_title: "Review & Submit",
    wizard_address: "Project Address",
    wizard_project_type: "Project Type",
    wizard_property_type: "Property Type",
    wizard_square_feet: "Square Feet / Area",
    wizard_budget: "Budget Range",
    wizard_timeline: "Timeline",
    wizard_preferred_contact: "Preferred Contact Method",
    wizard_review_title: "Review Your Information:",
    wizard_prev: "Previous",
    wizard_next: "Next",
    wizard_submit: "Submit Quote",
    footer_tagline: "Professional construction and renovation services you can trust.",
    footer_quick_links: "Quick Links",
    footer_contact: "Contact Info",
    footer_social: "Follow Us",
    footer_privacy: "Privacy Policy",
    privacy_title: "Privacy Policy",
    privacy_last_updated: "Last Updated: January 1, 2024",
    privacy_section1_title: "1. Data Controller",
    privacy_section1_content: "The controller for the processing of your personal data is H.A.C. Renovation Inc., located at 2504 Place Keller, Canada. For any privacy inquiries or to exercise your rights, you can contact us at: hacrenovaccion@gmail.com.",
    privacy_section2_title: "2. Information We Collect",
    privacy_section2_content: "Through our contact form, we collect the information you voluntarily provide: full name, email address, phone number, postal address, and the content of your message.",
    privacy_section3_title: "3. Purpose and Legal Basis for Processing",
    privacy_section3_content: "We use your personal information to:",
    privacy_section3_main_purpose: "Main Purpose:",
    privacy_section3_main_purpose_text: "Contact you in response to your inquiry, follow up on your request, and maintain a record of your contact as a client or potential client of our company.",
    privacy_section3_legal_basis: "Legal Basis:",
    privacy_section3_legal_basis_text: "Your explicit consent, granted by checking the corresponding box when submitting the form.",
    privacy_section4_title: "4. Data Sharing",
    privacy_section4_content: "H.A.C. Renovation Inc. does not share, transfer, or sell your personal data to any third party for commercial purposes. Your data is used exclusively internally for the purposes described in this policy.",
    privacy_section5_title: "5. International Transfers",
    privacy_section5_content: "Your personal data is stored and processed solely on servers located in Canada. We do not carry out systematic international transfers of your information.",
    privacy_section6_title: "6. Data Retention",
    privacy_section6_content: "We will retain your personal data for a maximum period of two (2) years from our last communication, unless a contractual relationship is established. In that case, the retention period will be renewed, and your data will be kept for the duration of the business relationship and any additional time required by applicable laws.",
    privacy_section7_title: "7. Your Rights (Access, Rectification, and Withdrawal)",
    privacy_section7_content: "In accordance with Canada's Personal Information Protection and Electronic Documents Act (PIPEDA), you have the right to access your data, rectify any inaccuracies, and withdraw your consent at any time.",
    privacy_section7_instructions: "To exercise any of these rights, you must send a written request to the email address hacrenovaccion@gmail.com, clearly stating whether you wish to access, modify, or delete the information we have stored. We will address your request within a maximum of 30 business days.",
    privacy_section8_title: "8. Security and Complaints",
    privacy_section8_content: "We implement appropriate technical and organizational security measures to protect your data. If you believe the processing of your information violates the law, you have the right to file a complaint with the Office of the Privacy Commissioner of Canada (OPC).",
    privacy_section9_title: "9. Changes to This Policy",
    privacy_section9_content: "We reserve the right to modify this policy to reflect legal or operational updates. Any changes will be posted on this page with a revised \"Last Updated\" date.",
    privacy_back_home: "← Back to Home",
  },
  fr: {
    nav_about: "À propos",
    nav_services: "Services",
    nav_portfolio: "Portfolio",
    nav_contact: "Contact",
    nav_quote: "Obtenir un Devis",
    hero_title: "Transformez Votre Espace<br>avec un Savoir-faire Expert",
    hero_subtitle: "Services professionnels de construction et de rénovation pour projets résidentiels et commerciaux",
    hero_cta_primary: "Devis Gratuit",
    hero_cta_secondary: "Voir Notre Travail",
    about_title: "À propos de H.A.C. Renovation",
    about_text1:
      "Avec des années d'expérience dans l'industrie de la construction, H.A.C. Renovation Inc. s'est bâti une réputation d'excellence, de fiabilité et de savoir-faire exceptionnel. Nous nous spécialisons dans la transformation d'espaces résidentiels et commerciaux en environnements beaux et fonctionnels.",
    about_text2:
      "Notre équipe de professionnels qualifiés s'engage à fournir des résultats de haute qualité dans les délais et le budget. De la consultation initiale à l'achèvement du projet, nous travaillons en étroite collaboration avec nos clients pour que leur vision devienne réalité.",
    about_stat1: "Années d'Expérience",
    about_stat2: "Projets Réalisés",
    about_stat3: "Satisfaction Client",
    services_title: "Nos Services",
    services_subtitle: "Solutions complètes de construction et de rénovation pour les besoins de votre projet",
    service1_title: "Démolition Intérieure",
    service1_desc:
      "Services de démolition sûrs et efficaces pour préparer votre espace à la rénovation. Nous gérons tous les enlèvements de débris et la préparation du site.",
    service2_title: "Charpente et Structure",
    service2_desc:
      "Services de charpenterie experts pour murs, plafonds et modifications structurelles. Savoir-faire de qualité assurant stabilité et conformité aux codes.",
    service3_title: "Plâtre et Peinture",
    service3_desc:
      "Installation professionnelle de plaques de plâtre, plâtrage et services de peinture. Finitions lisses et couleurs éclatantes pour donner vie à votre vision.",
    service4_title: "Patio et Clôture",
    service4_desc:
      "Espaces extérieurs personnalisés avec de beaux patios et des clôtures sécurisées. Améliorez l'attrait et la fonctionnalité de votre propriété.",
    service5_title: "Travaux en Béton",
    service5_desc:
      "Solutions de béton durables pour fondations, allées, trottoirs et plus. Travail de précision qui résiste à l'épreuve du temps.",
    service6_title: "Planchers et Carrelage",
    service6_desc:
      "Installation experte de bois franc, stratifié, carreaux et plus. De beaux planchers qui allient style et durabilité.",
    portfolio_title: "Notre Travail",
    portfolio_subtitle: "Découvrez les transformations que nous avons réalisées pour nos clients satisfaits",
    portfolio_before: "Avant",
    portfolio_after: "Après",
    project1_title: "Rénovation de Cuisine",
    project1_desc: "Rénovation complète de cuisine avec nouvelles armoires, comptoirs et revêtements de sol",
    project2_title: "Rénovation de Salle de Bain",
    project2_desc: "Transformation moderne de salle de bain avec nouveaux accessoires et carrelage",
    project3_title: "Finition de Sous-sol",
    project3_desc: "Conversion complète du sous-sol en espace de divertissement habitable",
    project4_title: "Construction de Patio",
    project4_desc: "Patio extérieur personnalisé avec matériaux haut de gamme et aménagement paysager",
    contact_title: "Contactez-nous",
    contact_subtitle:
      "Prêt à commencer votre projet de rénovation ? Contactez-nous aujourd'hui pour une consultation et un devis gratuits.",
    contact_phone_label: "Téléphone",
    contact_email_label: "Courriel",
    contact_address_label: "Adresse",
    form_name: "Nom",
    form_email: "Courriel",
    form_phone: "Téléphone",
    form_message: "Message",
    form_submit: "Envoyer le Message",
    form_is_owner: "Je suis le propriétaire",
    form_get_quote: "Obtenir un Devis Gratuit",
    wizard_title: "Obtenez Votre Devis Gratuit",
    wizard_step1: "Info de Base",
    wizard_step2: "Détails du Projet",
    wizard_step3: "Budget & Temps",
    wizard_step4: "Révision",
    wizard_step1_title: "Informations de Base",
    wizard_step2_title: "Détails du Projet",
    wizard_step3_title: "Budget & Calendrier",
    wizard_step4_title: "Révision & Soumettre",
    wizard_address: "Adresse du Projet",
    wizard_project_type: "Type de Projet",
    wizard_property_type: "Type de Propriété",
    wizard_square_feet: "Pieds Carrés / Superficie",
    wizard_budget: "Gamme de Budget",
    wizard_timeline: "Calendrier",
    wizard_preferred_contact: "Méthode de Contact Préférée",
    wizard_review_title: "Réviser Vos Informations:",
    wizard_prev: "Précédent",
    wizard_next: "Suivant",
    wizard_submit: "Soumettre le Devis",
    footer_tagline: "Services professionnels de construction et de rénovation en qui vous pouvez avoir confiance.",
    footer_quick_links: "Liens Rapides",
    footer_contact: "Informations de Contact",
    footer_social: "Suivez-nous",
    footer_privacy: "Politique de Confidentialité",
    privacy_title: "Politique de Confidentialité",
    privacy_last_updated: "Dernière mise à jour : 1 janvier 2024",
    privacy_section1_title: "1. Responsable du traitement",
    privacy_section1_content: "Le responsable du traitement de vos données personnelles est H.A.C. Renovation Inc., situé au 2504 Place Keller, Canada. Pour toute question relative à la vie privée ou pour exercer vos droits, vous pouvez nous contacter à l'adresse : hacrenovaccion@gmail.com.",
    privacy_section2_title: "2. Informations que nous collectons",
    privacy_section2_content: "Via notre formulaire de contact, nous collectons les informations que vous nous fournissez volontairement : nom et prénom, adresse e-mail, numéro de téléphone, adresse postale et le contenu de votre message.",
    privacy_section3_title: "3. Finalité et base juridique du traitement",
    privacy_section3_content: "Nous utilisons vos informations personnelles pour :",
    privacy_section3_main_purpose: "Finalité principale :",
    privacy_section3_main_purpose_text: "Vous contacter en réponse à votre demande, assurer un suivi de celle-ci et conserver un registre de votre contact en tant que client ou client potentiel de notre entreprise.",
    privacy_section3_legal_basis: "Base juridique :",
    privacy_section3_legal_basis_text: "Votre consentement explicite, accordé en cochant la case correspondante lors de l'envoi du formulaire.",
    privacy_section4_title: "4. Partage des données",
    privacy_section4_content: "H.A.C. Renovation Inc. ne partage, ne cède ni ne vend vos données personnelles à aucun tiers à des fins commerciales. Vos données sont utilisées exclusivement en interne pour les finalités décrites dans cette politique.",
    privacy_section5_title: "5. Transferts internationaux",
    privacy_section5_content: "Vos données personnelles sont stockées et traitées exclusivement sur des serveurs situés au Canada. Nous n'effectuons pas de transferts internationaux systématiques de vos informations.",
    privacy_section6_title: "6. Conservation de vos données",
    privacy_section6_content: "Nous conserverons vos données personnelles pendant un délai maximum de deux (2) ans à partir de notre dernière communication, à moins qu'une relation contractuelle ne soit établie. Dans ce cas, le délai de conservation sera renouvelé et vos données seront conservées pour la durée de la relation commerciale et le temps supplémentaire exigé par les lois applicables.",
    privacy_section7_title: "7. Vos droits (Accès, Rectification et Retrait)",
    privacy_section7_content: "Conformément à la Loi sur la protection des renseignements personnels et les documents électroniques (LPIPDE) du Canada, vous avez le droit d'accéder à vos données, de les rectifier si elles sont inexactes et de retirer votre consentement à tout moment.",
    privacy_section7_instructions: "Pour exercer l'un de ces droits, vous devez envoyer une demande écrite à l'adresse e-mail hacrenovaccion@gmail.com, en indiquant clairement si vous souhaitez accéder, modifier ou supprimer les informations que nous avons stockées. Nous traiterons votre demande dans un délai maximum de 30 jours ouvrables.",
    privacy_section8_title: "8. Sécurité et Plaintes",
    privacy_section8_content: "Nous mettons en œuvre des mesures de sécurité techniques et organisationnelles appropriées pour protéger vos données. Si vous estimez que le traitement de vos informations enfreint la loi, vous avez le droit de déposer une plainte auprès du Commissariat à la protection de la vie privée du Canada (CPVP).",
    privacy_section9_title: "9. Modifications de cette politique",
    privacy_section9_content: "Nous nous réservons le droit de modifier cette politique pour refléter des mises à jour légales ou opérationnelles. Toute modification sera publiée sur cette page avec une date de \"Dernière mise à jour\" révisée.",
    privacy_back_home: "← Retour à l'accueil",
  },
}

// Current language (default: English)
let currentLanguage = "en"

// Toggle language function - switches between EN and FR
function toggleLanguage() {
  // Toggle between en and fr
  currentLanguage = currentLanguage === "en" ? "fr" : "en"

  // Update current language display
  const langDisplay = currentLanguage === "en" ? "EN" : "FR"
  document.getElementById("currentLang").textContent = langDisplay

  // Update mobile display if it exists
  const currentLangMobile = document.getElementById("currentLangMobile")
  if (currentLangMobile) {
    currentLangMobile.textContent = langDisplay
  }

  // Update all translatable elements
  const elements = document.querySelectorAll("[data-translate]")
  elements.forEach((element) => {
    const key = element.getAttribute("data-translate")
    if (translations[currentLanguage][key]) {
      element.innerHTML = translations[currentLanguage][key]
    }
  })

  // Update HTML lang attribute
  document.documentElement.lang = currentLanguage

  // Save preference
  localStorage.setItem("preferredLanguage", currentLanguage)
}

// Initialize language on page load
document.addEventListener("DOMContentLoaded", () => {
  // Load saved language preference or default to English
  const savedLang = localStorage.getItem("preferredLanguage")
  if (savedLang === "fr") {
    toggleLanguage()
  }

  // Language toggle button (desktop)
  const langToggle = document.getElementById("langToggle")
  if (langToggle) {
    langToggle.addEventListener("click", toggleLanguage)
  }

  // Language toggle button (mobile)
  const langToggleMobile = document.getElementById("langToggleMobile")
  if (langToggleMobile) {
    langToggleMobile.addEventListener("click", toggleLanguage)
  }

  // Header scroll effect
  const header = document.getElementById("header")
  const scrollToTopBtn = document.getElementById("scrollToTopBtn")
  
  window.addEventListener("scroll", () => {
    if (window.scrollY > 20) {
      header.classList.add("scrolled")
    } else {
      header.classList.remove("scrolled")
    }
    
    // Show/hide scroll to top button
    if (window.scrollY > 300) {
      scrollToTopBtn.classList.add("visible")
    } else {
      scrollToTopBtn.classList.remove("visible")
    }
  })
  
  // Scroll to top functionality
  scrollToTopBtn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth",
    })
  })

  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById("mobileMenuBtn")
  const mobileMenu = document.getElementById("mobileMenu")
  const menuIcon = document.getElementById("menuIcon")
  const closeIcon = document.getElementById("closeIcon")

  mobileMenuBtn.addEventListener("click", () => {
    mobileMenu.classList.toggle("hidden")
    menuIcon.classList.toggle("hidden")
    closeIcon.classList.toggle("hidden")
  })

  // Close mobile menu when clicking on links
  const mobileNavLinks = document.querySelectorAll(".mobile-nav-link")
  mobileNavLinks.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu.classList.add("hidden")
      menuIcon.classList.remove("hidden")
      closeIcon.classList.add("hidden")
    })
  })

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault()
      const target = document.querySelector(this.getAttribute("href"))
      if (target) {
        const headerHeight = header.offsetHeight
        const targetPosition = target.offsetTop - headerHeight
        window.scrollTo({
          top: targetPosition,
          behavior: "smooth",
        })
      }
    })
  })

  // Quote Wizard functionality
  const quoteWizardModal = document.getElementById("quoteWizardModal")
  const openQuoteWizardBtn = document.getElementById("openQuoteWizardBtn")
  const closeWizardBtn = document.getElementById("closeWizardBtn")
  const quoteWizardForm = document.getElementById("quoteWizardForm")
  const wizardNextBtn = document.getElementById("wizardNextBtn")
  const wizardPrevBtn = document.getElementById("wizardPrevBtn")
  const wizardSubmitBtn = document.getElementById("wizardSubmitBtn")
  
  let currentStep = 1
  const totalSteps = 4

  // Open wizard and pre-fill data from contact form
  openQuoteWizardBtn.addEventListener("click", () => {
    const contactName = document.getElementById("contactName").value
    const contactEmail = document.getElementById("contactEmail").value
    const contactPhone = document.getElementById("contactPhone").value
    const contactIsOwner = document.getElementById("contactIsOwner").checked

    // Pre-fill wizard form
    document.getElementById("wizardName").value = contactName
    document.getElementById("wizardEmail").value = contactEmail
    document.getElementById("wizardPhone").value = contactPhone
    document.getElementById("wizardIsOwner").checked = contactIsOwner

    // Reset wizard to step 1
    currentStep = 1
    quoteWizardModal.classList.remove("hidden")
    document.body.style.overflow = "hidden"
    // Update steps after modal is visible
    setTimeout(() => {
      updateWizardSteps()
    }, 100)
  })

  // Portfolio card buttons - open wizard with pre-selected project
  document.querySelectorAll(".portfolio-quote-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      const projectName = btn.getAttribute("data-project")
      const wizardPortfolioProject = document.getElementById("wizardPortfolioProject")
      
      // Pre-select the project in the select
      if (wizardPortfolioProject) {
        wizardPortfolioProject.value = projectName
      }

      // Reset wizard to step 1
      currentStep = 1
      quoteWizardModal.classList.remove("hidden")
      document.body.style.overflow = "hidden"
      // Update steps after modal is visible
      setTimeout(() => {
        updateWizardSteps()
      }, 100)
    })
  })

  // Listen for changes in project type selects to toggle steps
  const wizardPortfolioProject = document.getElementById("wizardPortfolioProject")
  const wizardProjectType = document.getElementById("wizardProjectType")
  
  if (wizardPortfolioProject) {
    wizardPortfolioProject.addEventListener("change", () => {
      updateWizardSteps()
    })
  }
  
  if (wizardProjectType) {
    wizardProjectType.addEventListener("change", () => {
      updateWizardSteps()
    })
  }

  // Close wizard
  closeWizardBtn.addEventListener("click", () => {
    closeWizard()
  })

  quoteWizardModal.addEventListener("click", (e) => {
    if (e.target === quoteWizardModal || e.target.classList.contains("wizard-overlay")) {
      closeWizard()
    }
  })

  function closeWizard() {
    quoteWizardModal.classList.add("hidden")
    document.body.style.overflow = ""
    currentStep = 1
    updateWizardSteps()
  }

  // Update wizard step indicators
  function updateWizardSteps() {
    const isBathroom = isBathroomProject()
    
    // Show/hide step groups based on project type
    const defaultSteps = document.querySelectorAll(".wizard-step-default")
    const bathroomSteps = document.querySelectorAll(".wizard-step-bathroom")

    if (isBathroom) {
      defaultSteps.forEach(step => step.classList.add("hidden"))
      bathroomSteps.forEach(step => step.classList.remove("hidden"))
    } else {
      defaultSteps.forEach(step => step.classList.remove("hidden"))
      bathroomSteps.forEach(step => step.classList.add("hidden"))
    }

    // Update step indicators
    document.querySelectorAll(".wizard-step").forEach((step, index) => {
      const stepNum = index + 1
      step.classList.remove("active", "completed")
      if (stepNum < currentStep) {
        step.classList.add("completed")
      } else if (stepNum === currentStep) {
        step.classList.add("active")
      }
    })

    // Update step content visibility - only show active step for current project type
    document.querySelectorAll(".wizard-step-content").forEach((content) => {
      const stepNum = parseInt(content.getAttribute("data-step"))
      const isDefault = content.classList.contains("wizard-step-default")
      const isBathroomStep = content.classList.contains("wizard-step-bathroom")
      const isStep1 = stepNum === 1
      
      // Remove active from all
      content.classList.remove("active")
      
      // Step 1 is always visible (common for all project types)
      if (isStep1) {
        if (stepNum === currentStep) {
          content.classList.add("active")
          content.classList.remove("hidden")
        } else {
          content.classList.add("hidden")
        }
      } else {
        // Show only the active step that matches the project type
        if (stepNum === currentStep) {
          if ((isBathroom && isBathroomStep) || (!isBathroom && isDefault)) {
            content.classList.add("active")
            content.classList.remove("hidden")
          } else {
            content.classList.add("hidden")
          }
        } else {
          // Hide all other steps
          content.classList.add("hidden")
        }
      }
    })

    // Update navigation buttons
    wizardPrevBtn.classList.toggle("hidden", currentStep === 1)
    wizardNextBtn.classList.toggle("hidden", currentStep === totalSteps)
    wizardSubmitBtn.classList.toggle("hidden", currentStep !== totalSteps)

    // Update review on step 4
    if (currentStep === 4) {
      updateReview()
    }
  }

  // Next step
  wizardNextBtn.addEventListener("click", () => {
    if (validateCurrentStep()) {
      currentStep++
      updateWizardSteps()
    }
  })

  // Previous step
  wizardPrevBtn.addEventListener("click", () => {
    currentStep--
    updateWizardSteps()
  })

  // Validate current step
  function validateCurrentStep() {
    const currentStepContent = document.querySelector(`.wizard-step-content[data-step="${currentStep}"].active`)
    if (!currentStepContent) return false
    
    const requiredFields = currentStepContent.querySelectorAll("input[required], select[required]")
    let isValid = true

    // Special validation for Step 1 - privacy policy checkbox
    if (currentStep === 1) {
      const privacyCheckbox = document.getElementById("wizardPrivacyPolicy")
      if (privacyCheckbox && !privacyCheckbox.checked) {
        isValid = false
        privacyCheckbox.classList.add("border-red-500", "ring-2", "ring-red-500")
        setTimeout(() => {
          privacyCheckbox.classList.remove("border-red-500", "ring-2", "ring-red-500")
        }, 3000)
      }
    }

    requiredFields.forEach((field) => {
      if (field.type === "checkbox") {
        if (!field.checked && field.required) {
          isValid = false
          field.classList.add("border-red-500", "ring-2", "ring-red-500")
          setTimeout(() => {
            field.classList.remove("border-red-500", "ring-2", "ring-red-500")
          }, 3000)
        }
      } else if (field.type === "radio") {
        const radioGroup = currentStepContent.querySelectorAll(`input[name="${field.name}"][required]`)
        const isRadioChecked = Array.from(radioGroup).some(radio => radio.checked)
        if (!isRadioChecked) {
          isValid = false
          radioGroup.forEach(radio => {
            radio.closest("label")?.classList.add("border-red-500")
            setTimeout(() => {
              radio.closest("label")?.classList.remove("border-red-500")
            }, 3000)
          })
        }
      } else if (!field.value.trim()) {
        isValid = false
        field.classList.add("border-red-500")
        setTimeout(() => {
          field.classList.remove("border-red-500")
        }, 3000)
      } else {
        field.classList.remove("border-red-500")
      }
    })

    return isValid
  }

  // Check if current project is Bathroom Remodel
  function isBathroomProject() {
    const portfolioProject = document.getElementById("wizardPortfolioProject")?.value
    const projectType = document.getElementById("wizardProjectType")?.value
    return portfolioProject === "Bathroom Remodel" || projectType === "Bathroom"
  }


  // Calculate bathroom category based on answers
  function calculateBathroomCategory() {
    const answers = {
      goal: document.querySelector('input[name="bathroom_goal"]:checked')?.getAttribute("data-category"),
      layout: document.querySelector('input[name="bathroom_layout"]:checked')?.getAttribute("data-category"),
      shower_tub: document.querySelector('input[name="bathroom_shower_tub"]:checked')?.getAttribute("data-category"),
      finishes: document.querySelector('input[name="bathroom_finishes"]:checked')?.getAttribute("data-category"),
      vanity: document.querySelector('input[name="bathroom_vanity"]:checked')?.getAttribute("data-category"),
      durability: document.querySelector('input[name="bathroom_durability"]:checked')?.getAttribute("data-category"),
      budget: document.querySelector('input[name="bathroom_budget"]:checked')?.getAttribute("data-category")
    }

    // Count upgrades
    const upgrades = document.querySelectorAll('input[name="bathroom_upgrades"]:checked')
    let upgradesCategory = "basic"
    if (upgrades.length === 0) {
      upgradesCategory = "basic"
    } else if (upgrades.length <= 2) {
      upgradesCategory = "mid-range"
    } else {
      upgradesCategory = "high-end"
    }

    // Map categories to points
    const categoryPoints = { "basic": 1, "mid-range": 2, "high-end": 3 }
    let totalPoints = 0
    let count = 0

    Object.values(answers).forEach(category => {
      if (category) {
        totalPoints += categoryPoints[category] || 0
        count++
      }
    })

    // Add upgrades points
    totalPoints += categoryPoints[upgradesCategory] || 0
    count++

    if (count === 0) return "Basic"

    const average = totalPoints / count

    if (average < 1.5) return "Basic"
    if (average <= 2.5) return "Mid-Range"
    return "High-End"
  }

  // Update review section
  function updateReview() {
    const isBathroom = isBathroomProject()
    const formData = new FormData(quoteWizardForm)
    
    if (isBathroom) {
      const reviewDiv = document.getElementById("wizardReviewBathroom")
      const categoryDiv = document.getElementById("bathroomCategoryValue")
      const category = calculateBathroomCategory()
      
      const bathroomAnswers = {
        goal: document.querySelector('input[name="bathroom_goal"]:checked')?.closest("label")?.textContent.trim() || "Not answered",
        layout: document.querySelector('input[name="bathroom_layout"]:checked')?.closest("label")?.textContent.trim() || "Not answered",
        shower_tub: document.querySelector('input[name="bathroom_shower_tub"]:checked')?.closest("label")?.textContent.trim() || "Not answered",
        finishes: document.querySelector('input[name="bathroom_finishes"]:checked')?.closest("label")?.textContent.trim() || "Not answered",
        vanity: document.querySelector('input[name="bathroom_vanity"]:checked')?.closest("label")?.textContent.trim() || "Not answered",
        durability: document.querySelector('input[name="bathroom_durability"]:checked')?.closest("label")?.textContent.trim() || "Not answered",
        budget: document.querySelector('input[name="bathroom_budget"]:checked')?.closest("label")?.textContent.trim() || "Not answered"
      }

      const upgrades = Array.from(document.querySelectorAll('input[name="bathroom_upgrades"]:checked'))
        .map(checkbox => checkbox.closest("label")?.textContent.trim())
        .filter(Boolean)

      reviewDiv.innerHTML = `
        <p><strong>Name:</strong> ${formData.get("name") || "Not provided"}</p>
        <p><strong>Email:</strong> ${formData.get("email") || "Not provided"}</p>
        <p><strong>Phone:</strong> ${formData.get("phone") || "Not provided"}</p>
        <p><strong>Address:</strong> ${formData.get("address") || "Not provided"}</p>
        <p><strong>Property Owner:</strong> ${formData.get("is_owner") ? "Yes" : "No"}</p>
        <hr class="my-2">
        <p><strong>1. Main Goal:</strong> ${bathroomAnswers.goal}</p>
        <p><strong>2. Layout:</strong> ${bathroomAnswers.layout}</p>
        <p><strong>3. Shower/Tub:</strong> ${bathroomAnswers.shower_tub}</p>
        <p><strong>4. Finishes:</strong> ${bathroomAnswers.finishes}</p>
        <p><strong>5. Vanity:</strong> ${bathroomAnswers.vanity}</p>
        <p><strong>6. Upgrades:</strong> ${upgrades.length > 0 ? upgrades.join(", ") : "None"}</p>
        <p><strong>7. Durability:</strong> ${bathroomAnswers.durability}</p>
        <p><strong>8. Budget:</strong> ${bathroomAnswers.budget}</p>
        ${formData.get("message") ? `<p><strong>Notes:</strong> ${formData.get("message")}</p>` : ""}
      `
      
      if (categoryDiv) {
        categoryDiv.textContent = category
      }
    } else {
      const reviewDiv = document.getElementById("wizardReview")
      
      const reviewData = {
        name: formData.get("name") || "Not provided",
        email: formData.get("email") || "Not provided",
        phone: formData.get("phone") || "Not provided",
        address: formData.get("address") || "Not provided",
        is_owner: formData.get("is_owner") ? "Yes" : "No",
        portfolio_project: formData.get("portfolio_project") || "Not provided",
        project_type: formData.get("project_type") || "Not provided",
        property_type: formData.get("property_type") || "Not provided",
        square_feet: formData.get("square_feet") || "Not provided",
        budget: formData.get("budget") || "Not provided",
        timeline: formData.get("timeline") || "Not provided",
        preferred_contact: formData.get("preferred_contact") || "Not provided",
        message: formData.get("message") || "None"
      }

      reviewDiv.innerHTML = `
        <p><strong>Name:</strong> ${reviewData.name}</p>
        <p><strong>Email:</strong> ${reviewData.email}</p>
        <p><strong>Phone:</strong> ${reviewData.phone}</p>
        <p><strong>Address:</strong> ${reviewData.address}</p>
        <p><strong>Property Owner:</strong> ${reviewData.is_owner}</p>
        <p><strong>Project from Portfolio:</strong> ${reviewData.portfolio_project}</p>
        <p><strong>Project Type:</strong> ${reviewData.project_type}</p>
        <p><strong>Property Type:</strong> ${reviewData.property_type}</p>
        <p><strong>Square Feet:</strong> ${reviewData.square_feet}</p>
        <p><strong>Budget:</strong> ${reviewData.budget}</p>
        <p><strong>Timeline:</strong> ${reviewData.timeline}</p>
        <p><strong>Preferred Contact:</strong> ${reviewData.preferred_contact}</p>
        ${reviewData.message !== "None" ? `<p><strong>Notes:</strong> ${reviewData.message}</p>` : ""}
      `
    }
  }

  // Submit form to Google Sheets
  quoteWizardForm.addEventListener("submit", async (e) => {
    e.preventDefault()
    
    if (!validateCurrentStep()) {
      return
    }

    const formData = new FormData(quoteWizardForm)
    const isBathroom = isBathroomProject()
    
    const data = {
      name: formData.get("name"),
      email: formData.get("email"),
      phone: formData.get("phone"),
      message: formData.get("message") || "",
      is_owner: formData.get("is_owner") ? "TRUE" : "FALSE",
      address: formData.get("address"),
      portfolio_project: formData.get("portfolio_project") || "",
      privacy_policy: formData.get("privacy_policy") ? "TRUE" : "FALSE",
      created_at: new Date().toISOString(),
      status: "new"
    }

    // Add bathroom-specific data or default project data
    if (isBathroom) {
      data.project_type = "Bathroom Remodel"
      data.bathroom_category = calculateBathroomCategory()
      data.bathroom_goal = document.querySelector('input[name="bathroom_goal"]:checked')?.value || ""
      data.bathroom_layout = document.querySelector('input[name="bathroom_layout"]:checked')?.value || ""
      data.bathroom_shower_tub = document.querySelector('input[name="bathroom_shower_tub"]:checked')?.value || ""
      data.bathroom_finishes = document.querySelector('input[name="bathroom_finishes"]:checked')?.value || ""
      data.bathroom_vanity = document.querySelector('input[name="bathroom_vanity"]:checked')?.value || ""
      data.bathroom_durability = document.querySelector('input[name="bathroom_durability"]:checked')?.value || ""
      data.bathroom_budget = document.querySelector('input[name="bathroom_budget"]:checked')?.value || ""
      data.bathroom_upgrades = Array.from(document.querySelectorAll('input[name="bathroom_upgrades"]:checked'))
        .map(cb => cb.value)
        .join(", ")
    } else {
      data.project_type = formData.get("project_type") || ""
      data.property_type = formData.get("property_type") || ""
      data.square_feet = formData.get("square_feet") || ""
      data.budget = formData.get("budget") || ""
      data.timeline = formData.get("timeline") || ""
      data.preferred_contact = formData.get("preferred_contact") || ""
    }

    // Disable submit button
    wizardSubmitBtn.disabled = true
    wizardSubmitBtn.textContent = currentLanguage === "en" ? "Submitting..." : "Envoi en cours..."

    try {
      // Google Apps Script URL
      const scriptURL = "https://script.google.com/macros/s/AKfycbxcIVolM9jPbe1_2avpIszdyA9efwO7Z_HApvVWg_cBXp5djGZDJlMdZkPLPHLG23g/exec"
      
      // Check if URL is still placeholder
      if (scriptURL === "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE" || !scriptURL.includes("script.google.com")) {
        const configMessage = currentLanguage === "en"
          ? "⚠️ Google Sheets integration not configured yet.\n\nPlease:\n1. Open your Google Sheet\n2. Go to Extensions > Apps Script\n3. Deploy as Web App\n4. Copy the URL and paste it in script.js (line 485)\n\nFor now, your data:\n" + JSON.stringify(data, null, 2)
          : "⚠️ Intégration Google Sheets non configurée.\n\nVeuillez:\n1. Ouvrir votre Google Sheet\n2. Aller à Extensions > Apps Script\n3. Déployer comme Application Web\n4. Copier l'URL et la coller dans script.js (ligne 485)\n\nPour l'instant, vos données:\n" + JSON.stringify(data, null, 2)
        
        alert(configMessage)
        console.log("Form data:", data)
        wizardSubmitBtn.disabled = false
        wizardSubmitBtn.textContent = currentLanguage === "en" ? "Submit Quote" : "Soumettre le devis"
        return
      }
      
      // Log data being sent for debugging
      console.log("Sending data to Google Sheets:", data)
      
      // Use FormData approach which works better with Google Apps Script
      const formData = new FormData()
      Object.keys(data).forEach(key => {
        formData.append(key, data[key])
      })
      
      // Alternative: Send as URL-encoded form data (more compatible with Google Apps Script)
      const urlEncodedData = new URLSearchParams()
      Object.keys(data).forEach(key => {
        urlEncodedData.append(key, data[key])
      })
      
      // Try with URL-encoded first (more reliable with Google Apps Script)
      const response = await fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: urlEncodedData.toString()
      })
      
      // Since we use no-cors, we can't read the response, but we can log
      console.log("Request sent to Google Sheets")
      
      // Wait a moment to ensure the request is processed
      await new Promise(resolve => setTimeout(resolve, 1000))
      
      // Show success message
      const successMessage = currentLanguage === "en"
        ? "Thank you! Your quote request has been submitted. We will contact you soon."
        : "Merci! Votre demande de devis a été soumise. Nous vous contacterons bientôt."
      
      alert(successMessage)
      
      // Reset forms
      quoteWizardForm.reset()
      document.getElementById("contactForm").reset()
      closeWizard()
      
    } catch (error) {
      console.error("Error:", error)
      console.error("Error details:", error.message)
      const errorMessage = currentLanguage === "en"
        ? "There was an error submitting your request. Please try again or contact us directly. Check the console for details."
        : "Une erreur s'est produite lors de l'envoi de votre demande. Veuillez réessayer ou nous contacter directement. Vérifiez la console pour plus de détails."
      alert(errorMessage)
    } finally {
      wizardSubmitBtn.disabled = false
      wizardSubmitBtn.textContent = currentLanguage === "en" ? "Submit Quote" : "Soumettre le devis"
    }
  })

  // Contact form submission (keep for simple contact)
  const contactForm = document.getElementById("contactForm")
  // Remove old submit handler since we're using the wizard now
})
