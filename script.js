// Translations
const translations = {
  en: {
    nav_about: "About",
    nav_services: "Services",
    nav_portfolio: "Portfolio",
    nav_contact: "Contact",
    nav_quote: "Get a Quote",
    hero_title: "Transform Your Space<br>with Expert Craftsmanship",
    hero_subtitle: "Professional construction and renovation services for residential and commercial projects",
    hero_cta_primary: "Get Free Quote",
    hero_cta_secondary: "View Our Work",
    about_title: "About H.A.C. Renovation",
    about_text1:
      "With years of experience in the construction industry, H.A.C. Renovation Inc. has built a reputation for excellence, reliability, and outstanding craftsmanship. We specialize in transforming residential and commercial spaces into beautiful, functional environments.",
    about_text2:
      "Our team of skilled professionals is committed to delivering high-quality results on time and within budget. From initial consultation to project completion, we work closely with our clients to ensure their vision becomes reality.",
    about_stat1: "Years Experience",
    about_stat2: "Projects Completed",
    about_stat3: "Client Satisfaction",
    services_title: "Our Services",
    services_subtitle: "Comprehensive construction and renovation solutions for your project needs",
    service1_title: "Interior Demolition",
    service1_desc:
      "Safe and efficient demolition services to prepare your space for renovation. We handle all debris removal and site preparation.",
    service2_title: "Framing & Structure",
    service2_desc:
      "Expert framing services for walls, ceilings, and structural modifications. Quality craftsmanship ensuring stability and code compliance.",
    service3_title: "Plaster & Painting",
    service3_desc:
      "Professional drywall installation, plastering, and painting services. Smooth finishes and vibrant colors to bring your vision to life.",
    service4_title: "Patio & Fencing",
    service4_desc:
      "Custom outdoor living spaces with beautiful patios and secure fencing. Enhance your property's curb appeal and functionality.",
    service5_title: "Concrete Work",
    service5_desc:
      "Durable concrete solutions for foundations, driveways, walkways, and more. Precision work that stands the test of time.",
    service6_title: "Floors & Tiling",
    service6_desc:
      "Expert installation of hardwood, laminate, tile, and more. Beautiful floors that combine style with durability.",
    portfolio_title: "Our Work",
    portfolio_subtitle: "See the transformations we've accomplished for our satisfied clients",
    portfolio_before: "Before",
    portfolio_after: "After",
    project1_title: "Kitchen Renovation",
    project1_desc: "Complete kitchen remodel with new cabinets, countertops, and flooring",
    project2_title: "Bathroom Remodel",
    project2_desc: "Modern bathroom transformation with new fixtures and tiling",
    project3_title: "Basement Finishing",
    project3_desc: "Complete basement conversion into livable entertainment space",
    project4_title: "Patio Construction",
    project4_desc: "Custom outdoor patio with premium materials and landscaping",
    contact_title: "Get in Touch",
    contact_subtitle: "Ready to start your renovation project? Contact us today for a free consultation and quote.",
    contact_phone_label: "Phone",
    contact_email_label: "Email",
    contact_address_label: "Address",
    form_name: "Name",
    form_email: "Email",
    form_phone: "Phone",
    form_message: "Message",
    form_submit: "Send Message",
    form_is_owner: "I am the property owner",
    form_get_quote: "Get Free Quote",
    wizard_title: "Get Your Free Quote",
    wizard_step1: "Basic Info",
    wizard_step2: "Project Details",
    wizard_step3: "Budget & Time",
    wizard_step4: "Review",
    wizard_step1_title: "Basic Information",
    wizard_step2_title: "Project Details",
    wizard_step3_title: "Budget & Timeline",
    wizard_step4_title: "Review & Submit",
    wizard_address: "Project Address",
    wizard_project_type: "Project Type",
    wizard_property_type: "Property Type",
    wizard_square_feet: "Square Feet / Area",
    wizard_budget: "Budget Range",
    wizard_timeline: "Timeline",
    wizard_preferred_contact: "Preferred Contact Method",
    wizard_review_title: "Review Your Information:",
    wizard_prev: "Previous",
    wizard_next: "Next",
    wizard_submit: "Submit Quote",
    footer_tagline: "Professional construction and renovation services you can trust.",
    footer_quick_links: "Quick Links",
    footer_contact: "Contact Info",
    footer_social: "Follow Us",
  },
  fr: {
    nav_about: "À propos",
    nav_services: "Services",
    nav_portfolio: "Portfolio",
    nav_contact: "Contact",
    nav_quote: "Obtenir un Devis",
    hero_title: "Transformez Votre Espace<br>avec un Savoir-faire Expert",
    hero_subtitle: "Services professionnels de construction et de rénovation pour projets résidentiels et commerciaux",
    hero_cta_primary: "Devis Gratuit",
    hero_cta_secondary: "Voir Notre Travail",
    about_title: "À propos de H.A.C. Renovation",
    about_text1:
      "Avec des années d'expérience dans l'industrie de la construction, H.A.C. Renovation Inc. s'est bâti une réputation d'excellence, de fiabilité et de savoir-faire exceptionnel. Nous nous spécialisons dans la transformation d'espaces résidentiels et commerciaux en environnements beaux et fonctionnels.",
    about_text2:
      "Notre équipe de professionnels qualifiés s'engage à fournir des résultats de haute qualité dans les délais et le budget. De la consultation initiale à l'achèvement du projet, nous travaillons en étroite collaboration avec nos clients pour que leur vision devienne réalité.",
    about_stat1: "Années d'Expérience",
    about_stat2: "Projets Réalisés",
    about_stat3: "Satisfaction Client",
    services_title: "Nos Services",
    services_subtitle: "Solutions complètes de construction et de rénovation pour les besoins de votre projet",
    service1_title: "Démolition Intérieure",
    service1_desc:
      "Services de démolition sûrs et efficaces pour préparer votre espace à la rénovation. Nous gérons tous les enlèvements de débris et la préparation du site.",
    service2_title: "Charpente et Structure",
    service2_desc:
      "Services de charpenterie experts pour murs, plafonds et modifications structurelles. Savoir-faire de qualité assurant stabilité et conformité aux codes.",
    service3_title: "Plâtre et Peinture",
    service3_desc:
      "Installation professionnelle de plaques de plâtre, plâtrage et services de peinture. Finitions lisses et couleurs éclatantes pour donner vie à votre vision.",
    service4_title: "Patio et Clôture",
    service4_desc:
      "Espaces extérieurs personnalisés avec de beaux patios et des clôtures sécurisées. Améliorez l'attrait et la fonctionnalité de votre propriété.",
    service5_title: "Travaux en Béton",
    service5_desc:
      "Solutions de béton durables pour fondations, allées, trottoirs et plus. Travail de précision qui résiste à l'épreuve du temps.",
    service6_title: "Planchers et Carrelage",
    service6_desc:
      "Installation experte de bois franc, stratifié, carreaux et plus. De beaux planchers qui allient style et durabilité.",
    portfolio_title: "Notre Travail",
    portfolio_subtitle: "Découvrez les transformations que nous avons réalisées pour nos clients satisfaits",
    portfolio_before: "Avant",
    portfolio_after: "Après",
    project1_title: "Rénovation de Cuisine",
    project1_desc: "Rénovation complète de cuisine avec nouvelles armoires, comptoirs et revêtements de sol",
    project2_title: "Rénovation de Salle de Bain",
    project2_desc: "Transformation moderne de salle de bain avec nouveaux accessoires et carrelage",
    project3_title: "Finition de Sous-sol",
    project3_desc: "Conversion complète du sous-sol en espace de divertissement habitable",
    project4_title: "Construction de Patio",
    project4_desc: "Patio extérieur personnalisé avec matériaux haut de gamme et aménagement paysager",
    contact_title: "Contactez-nous",
    contact_subtitle:
      "Prêt à commencer votre projet de rénovation ? Contactez-nous aujourd'hui pour une consultation et un devis gratuits.",
    contact_phone_label: "Téléphone",
    contact_email_label: "Courriel",
    contact_address_label: "Adresse",
    form_name: "Nom",
    form_email: "Courriel",
    form_phone: "Téléphone",
    form_message: "Message",
    form_submit: "Envoyer le Message",
    form_is_owner: "Je suis le propriétaire",
    form_get_quote: "Obtenir un Devis Gratuit",
    wizard_title: "Obtenez Votre Devis Gratuit",
    wizard_step1: "Info de Base",
    wizard_step2: "Détails du Projet",
    wizard_step3: "Budget & Temps",
    wizard_step4: "Révision",
    wizard_step1_title: "Informations de Base",
    wizard_step2_title: "Détails du Projet",
    wizard_step3_title: "Budget & Calendrier",
    wizard_step4_title: "Révision & Soumettre",
    wizard_address: "Adresse du Projet",
    wizard_project_type: "Type de Projet",
    wizard_property_type: "Type de Propriété",
    wizard_square_feet: "Pieds Carrés / Superficie",
    wizard_budget: "Gamme de Budget",
    wizard_timeline: "Calendrier",
    wizard_preferred_contact: "Méthode de Contact Préférée",
    wizard_review_title: "Réviser Vos Informations:",
    wizard_prev: "Précédent",
    wizard_next: "Suivant",
    wizard_submit: "Soumettre le Devis",
    footer_tagline: "Services professionnels de construction et de rénovation en qui vous pouvez avoir confiance.",
    footer_quick_links: "Liens Rapides",
    footer_contact: "Informations de Contact",
    footer_social: "Suivez-nous",
  },
}

// Current language (default: English)
let currentLanguage = "en"

// Toggle language function - switches between EN and FR
function toggleLanguage() {
  // Toggle between en and fr
  currentLanguage = currentLanguage === "en" ? "fr" : "en"

  // Update current language display
  const langDisplay = currentLanguage === "en" ? "EN" : "FR"
  document.getElementById("currentLang").textContent = langDisplay

  // Update mobile display if it exists
  const currentLangMobile = document.getElementById("currentLangMobile")
  if (currentLangMobile) {
    currentLangMobile.textContent = langDisplay
  }

  // Update all translatable elements
  const elements = document.querySelectorAll("[data-translate]")
  elements.forEach((element) => {
    const key = element.getAttribute("data-translate")
    if (translations[currentLanguage][key]) {
      element.innerHTML = translations[currentLanguage][key]
    }
  })

  // Update HTML lang attribute
  document.documentElement.lang = currentLanguage

  // Save preference
  localStorage.setItem("preferredLanguage", currentLanguage)
}

// Initialize language on page load
document.addEventListener("DOMContentLoaded", () => {
  // Load saved language preference or default to English
  const savedLang = localStorage.getItem("preferredLanguage")
  if (savedLang === "fr") {
    toggleLanguage()
  }

  // Language toggle button (desktop)
  const langToggle = document.getElementById("langToggle")
  if (langToggle) {
    langToggle.addEventListener("click", toggleLanguage)
  }

  // Language toggle button (mobile)
  const langToggleMobile = document.getElementById("langToggleMobile")
  if (langToggleMobile) {
    langToggleMobile.addEventListener("click", toggleLanguage)
  }

  // Header scroll effect
  const header = document.getElementById("header")
  const scrollToTopBtn = document.getElementById("scrollToTopBtn")
  
  window.addEventListener("scroll", () => {
    if (window.scrollY > 20) {
      header.classList.add("scrolled")
    } else {
      header.classList.remove("scrolled")
    }
    
    // Show/hide scroll to top button
    if (window.scrollY > 300) {
      scrollToTopBtn.classList.add("visible")
    } else {
      scrollToTopBtn.classList.remove("visible")
    }
  })
  
  // Scroll to top functionality
  scrollToTopBtn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth",
    })
  })

  // Mobile menu toggle
  const mobileMenuBtn = document.getElementById("mobileMenuBtn")
  const mobileMenu = document.getElementById("mobileMenu")
  const menuIcon = document.getElementById("menuIcon")
  const closeIcon = document.getElementById("closeIcon")

  mobileMenuBtn.addEventListener("click", () => {
    mobileMenu.classList.toggle("hidden")
    menuIcon.classList.toggle("hidden")
    closeIcon.classList.toggle("hidden")
  })

  // Close mobile menu when clicking on links
  const mobileNavLinks = document.querySelectorAll(".mobile-nav-link")
  mobileNavLinks.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu.classList.add("hidden")
      menuIcon.classList.remove("hidden")
      closeIcon.classList.add("hidden")
    })
  })

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
    anchor.addEventListener("click", function (e) {
      e.preventDefault()
      const target = document.querySelector(this.getAttribute("href"))
      if (target) {
        const headerHeight = header.offsetHeight
        const targetPosition = target.offsetTop - headerHeight
        window.scrollTo({
          top: targetPosition,
          behavior: "smooth",
        })
      }
    })
  })

  // Quote Wizard functionality
  const quoteWizardModal = document.getElementById("quoteWizardModal")
  const openQuoteWizardBtn = document.getElementById("openQuoteWizardBtn")
  const closeWizardBtn = document.getElementById("closeWizardBtn")
  const quoteWizardForm = document.getElementById("quoteWizardForm")
  const wizardNextBtn = document.getElementById("wizardNextBtn")
  const wizardPrevBtn = document.getElementById("wizardPrevBtn")
  const wizardSubmitBtn = document.getElementById("wizardSubmitBtn")
  
  let currentStep = 1
  const totalSteps = 4

  // Open wizard and pre-fill data from contact form
  openQuoteWizardBtn.addEventListener("click", () => {
    const contactName = document.getElementById("contactName").value
    const contactEmail = document.getElementById("contactEmail").value
    const contactPhone = document.getElementById("contactPhone").value
    const contactIsOwner = document.getElementById("contactIsOwner").checked

    // Pre-fill wizard form
    document.getElementById("wizardName").value = contactName
    document.getElementById("wizardEmail").value = contactEmail
    document.getElementById("wizardPhone").value = contactPhone
    document.getElementById("wizardIsOwner").checked = contactIsOwner

    // Reset wizard to step 1
    currentStep = 1
    updateWizardSteps()
    quoteWizardModal.classList.remove("hidden")
    document.body.style.overflow = "hidden"
  })

  // Close wizard
  closeWizardBtn.addEventListener("click", () => {
    closeWizard()
  })

  quoteWizardModal.addEventListener("click", (e) => {
    if (e.target === quoteWizardModal || e.target.classList.contains("wizard-overlay")) {
      closeWizard()
    }
  })

  function closeWizard() {
    quoteWizardModal.classList.add("hidden")
    document.body.style.overflow = ""
    currentStep = 1
    updateWizardSteps()
  }

  // Update wizard step indicators
  function updateWizardSteps() {
    // Update step indicators
    document.querySelectorAll(".wizard-step").forEach((step, index) => {
      const stepNum = index + 1
      step.classList.remove("active", "completed")
      if (stepNum < currentStep) {
        step.classList.add("completed")
      } else if (stepNum === currentStep) {
        step.classList.add("active")
      }
    })

    // Update step content visibility
    document.querySelectorAll(".wizard-step-content").forEach((content, index) => {
      const stepNum = index + 1
      content.classList.remove("active")
      if (stepNum === currentStep) {
        content.classList.add("active")
      }
    })

    // Update navigation buttons
    wizardPrevBtn.classList.toggle("hidden", currentStep === 1)
    wizardNextBtn.classList.toggle("hidden", currentStep === totalSteps)
    wizardSubmitBtn.classList.toggle("hidden", currentStep !== totalSteps)

    // Update review on step 4
    if (currentStep === 4) {
      updateReview()
    }
  }

  // Next step
  wizardNextBtn.addEventListener("click", () => {
    if (validateCurrentStep()) {
      currentStep++
      updateWizardSteps()
    }
  })

  // Previous step
  wizardPrevBtn.addEventListener("click", () => {
    currentStep--
    updateWizardSteps()
  })

  // Validate current step
  function validateCurrentStep() {
    const currentStepContent = document.querySelector(`.wizard-step-content[data-step="${currentStep}"]`)
    const requiredFields = currentStepContent.querySelectorAll("input[required], select[required]")
    let isValid = true

    requiredFields.forEach((field) => {
      if (!field.value.trim()) {
        isValid = false
        field.classList.add("border-red-500")
        setTimeout(() => {
          field.classList.remove("border-red-500")
        }, 3000)
      } else {
        field.classList.remove("border-red-500")
      }
    })

    return isValid
  }

  // Update review section
  function updateReview() {
    const reviewDiv = document.getElementById("wizardReview")
    const formData = new FormData(quoteWizardForm)
    
    const reviewData = {
      name: formData.get("name") || "Not provided",
      email: formData.get("email") || "Not provided",
      phone: formData.get("phone") || "Not provided",
      address: formData.get("address") || "Not provided",
      is_owner: formData.get("is_owner") ? "Yes" : "No",
      project_type: formData.get("project_type") || "Not provided",
      property_type: formData.get("property_type") || "Not provided",
      square_feet: formData.get("square_feet") || "Not provided",
      budget: formData.get("budget") || "Not provided",
      timeline: formData.get("timeline") || "Not provided",
      preferred_contact: formData.get("preferred_contact") || "Not provided",
      message: formData.get("message") || "None"
    }

    reviewDiv.innerHTML = `
      <p><strong>Name:</strong> ${reviewData.name}</p>
      <p><strong>Email:</strong> ${reviewData.email}</p>
      <p><strong>Phone:</strong> ${reviewData.phone}</p>
      <p><strong>Address:</strong> ${reviewData.address}</p>
      <p><strong>Property Owner:</strong> ${reviewData.is_owner}</p>
      <p><strong>Project Type:</strong> ${reviewData.project_type}</p>
      <p><strong>Property Type:</strong> ${reviewData.property_type}</p>
      <p><strong>Square Feet:</strong> ${reviewData.square_feet}</p>
      <p><strong>Budget:</strong> ${reviewData.budget}</p>
      <p><strong>Timeline:</strong> ${reviewData.timeline}</p>
      <p><strong>Preferred Contact:</strong> ${reviewData.preferred_contact}</p>
      ${reviewData.message !== "None" ? `<p><strong>Notes:</strong> ${reviewData.message}</p>` : ""}
    `
  }

  // Submit form to Google Sheets
  quoteWizardForm.addEventListener("submit", async (e) => {
    e.preventDefault()
    
    if (!validateCurrentStep()) {
      return
    }

    const formData = new FormData(quoteWizardForm)
    const data = {
      name: formData.get("name"),
      email: formData.get("email"),
      phone: formData.get("phone"),
      message: formData.get("message") || "",
      is_owner: formData.get("is_owner") ? "TRUE" : "FALSE",
      address: formData.get("address"),
      project_type: formData.get("project_type"),
      property_type: formData.get("property_type"),
      square_feet: formData.get("square_feet") || "",
      budget: formData.get("budget"),
      timeline: formData.get("timeline"),
      preferred_contact: formData.get("preferred_contact"),
      created_at: new Date().toISOString(),
      status: "new"
    }

    // Disable submit button
    wizardSubmitBtn.disabled = true
    wizardSubmitBtn.textContent = currentLanguage === "en" ? "Submitting..." : "Envoi en cours..."

    try {
      // Google Apps Script URL
      const scriptURL = "https://script.google.com/macros/s/AKfycbxcIVolM9jPbe1_2avpIszdyA9efwO7Z_HApvVWg_cBXp5djGZDJlMdZkPLPHLG23g/exec"
      
      // Check if URL is still placeholder
      if (scriptURL === "YOUR_GOOGLE_APPS_SCRIPT_URL_HERE" || !scriptURL.includes("script.google.com")) {
        const configMessage = currentLanguage === "en"
          ? "⚠️ Google Sheets integration not configured yet.\n\nPlease:\n1. Open your Google Sheet\n2. Go to Extensions > Apps Script\n3. Deploy as Web App\n4. Copy the URL and paste it in script.js (line 485)\n\nFor now, your data:\n" + JSON.stringify(data, null, 2)
          : "⚠️ Intégration Google Sheets non configurée.\n\nVeuillez:\n1. Ouvrir votre Google Sheet\n2. Aller à Extensions > Apps Script\n3. Déployer comme Application Web\n4. Copier l'URL et la coller dans script.js (ligne 485)\n\nPour l'instant, vos données:\n" + JSON.stringify(data, null, 2)
        
        alert(configMessage)
        console.log("Form data:", data)
        wizardSubmitBtn.disabled = false
        wizardSubmitBtn.textContent = currentLanguage === "en" ? "Submit Quote" : "Soumettre le devis"
        return
      }
      
      // Log data being sent for debugging
      console.log("Sending data to Google Sheets:", data)
      
      // Use FormData approach which works better with Google Apps Script
      const formData = new FormData()
      Object.keys(data).forEach(key => {
        formData.append(key, data[key])
      })
      
      // Alternative: Send as URL-encoded form data (more compatible with Google Apps Script)
      const urlEncodedData = new URLSearchParams()
      Object.keys(data).forEach(key => {
        urlEncodedData.append(key, data[key])
      })
      
      // Try with URL-encoded first (more reliable with Google Apps Script)
      const response = await fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
        body: urlEncodedData.toString()
      })
      
      // Since we use no-cors, we can't read the response, but we can log
      console.log("Request sent to Google Sheets")
      
      // Wait a moment to ensure the request is processed
      await new Promise(resolve => setTimeout(resolve, 1000))
      
      // Show success message
      const successMessage = currentLanguage === "en"
        ? "Thank you! Your quote request has been submitted. We will contact you soon."
        : "Merci! Votre demande de devis a été soumise. Nous vous contacterons bientôt."
      
      alert(successMessage)
      
      // Reset forms
      quoteWizardForm.reset()
      document.getElementById("contactForm").reset()
      closeWizard()
      
    } catch (error) {
      console.error("Error:", error)
      console.error("Error details:", error.message)
      const errorMessage = currentLanguage === "en"
        ? "There was an error submitting your request. Please try again or contact us directly. Check the console for details."
        : "Une erreur s'est produite lors de l'envoi de votre demande. Veuillez réessayer ou nous contacter directement. Vérifiez la console pour plus de détails."
      alert(errorMessage)
    } finally {
      wizardSubmitBtn.disabled = false
      wizardSubmitBtn.textContent = currentLanguage === "en" ? "Submit Quote" : "Soumettre le devis"
    }
  })

  // Contact form submission (keep for simple contact)
  const contactForm = document.getElementById("contactForm")
  // Remove old submit handler since we're using the wizard now
})
